language: android
dist: trusty

env:
  global:
    - secure: "XmW+8oFdSx4BGggHvniqukGx4VZbqftXosFvT4FR2utkfnuJIatyBGJ99FHnxIWYAwR5X/VFUhqKMYhOlPqcJhphhgFpfp5HEf+Sw7scOnBusotYzxlvRuGl2dZASWqf+rKxbnURCP1nMlL3fSK5eOfHB0TSzI1Q3qoswz4SgJUlLvdHP91btX1VYjeOHQ+60UNto3/04JKIZoLCDVCJnaMdIrkTisbMwt4cGfiKsaa7T+W8qAqwelHHjI4KwBSLA/DApbFmrszHyK76S8ibTjPOWPz3gVcDvVgxsSHrYVZBNvJjmWvPjeiJqeAk3GFEOaN+pzai3mnxq+QLyE49wxi+PWh4eYgVzsqbsAAnIzWX2I4ioLaWO1G4pgEltqCUONd9yZtFhbdVHtc2oRAg0u4viB1bqxsnAMPFAQvW2mcQWFAZmx4RLerQpKyhEnrBEZ7OgOCldCP6c5XY8rCYY0QZONDkp65f50AHGgmGRJxSMTw/R3y5LDon9mMTVc0L29BYGPgqkzYE68mL65NCLhgaR18M4gT5bsHzkRyhSg6cfdkloMtPOlKxwUJJZTB0hUpFe3NSmiizeOmgmM5GlZIvJ++Ug7n9EB15pOaDW0iqmWdCtANMvGW9MQFG6Zw68Frwp0tVTLeb4aQ5FFNbqQBorzGstSqKwXU9BkrMW9Q="
    - secure: "qnxQOFYHbOz2/nAgzBedNmu1Uin7QrtwhWGz9s8u41u9o2f4Bctch07pSZ5dcUIp3WW9nns7t7XTibpX1KkpeO88X1T+EIHTFCmB5PXQpu0hsKYdiJ1/g7vRsquJDMWOnQ3PazljaenJuoFT13XIvp72vifqtyACNJwplQm+NxM5e1bUINWzTeKmr+ECNGNqowHdP58aJ2UtQ1XJKt8udRCet/Vsy+TzLbVBWrRcWQqk8492fvy1O7iIZCYRvI3NUFL46l68zeNrERScIIDZ13vCss4lFY8FUCWyFEZIqj8G0j8cT8A9J1YXDTPTKj+0LvuaPU90aC+O9+SpnePzqj9xlvwS+XRj3ebVSN8t/RFTWawPgnffS0uwTuECWyH23WXJszXQjnHrluQKEEY0tMfWlS47jq5/rI5KGVXTaZ+WJ6/BClbHW/FIiAF7MliofuXIjFTW2hBT1I0RcycRjFa5q9Svdri5XOTpgh22ec7PSpN5QBifQB8qS9LK8mzW7GXp+Jb2Ct0vU2elUM/F2dxKW4P++7hmoOIaVOZcywPxjfWCmXSLjjo0Tu0lMr7a0HzJSsmRUeqb5/zNnHvfhxInOdMLjZS0A7Vr54XiGpkBCqa06Dma/E84kD4Xt6IejJ1cOrGPB3WgLlJVEHvX6tpEady9Gi90VFEUKGcMDMc="

android:
  components:
  - tools
  - platform-tools
  - build-tools-28.0.3
  - android-28
  - extra-google-google_play_services
  - extra-google-m2repository
  - extra-android-m2repository
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

script:
  - "./gradlew ktlintCheck"

before_deploy:
- cp $TRAVIS_BUILD_DIR/hackillinois.keystore $HOME
- cd app/build/outputs/apk/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/hackillinois.keystore -storepass $storepass -keypass $keypass app-release-unsigned.apk key0
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/28.0.3/zipalign -v 4 app-release-unsigned.apk hackillinois.apk"
deploy:
  provider: s3
  access_key_id: "$ACCESS_KEY_ID"
  secret_access_key: "$SECRET_ACCESS_KEY"
  bucket: "$DEVELOPMENT_BUCKET"
  skip_cleanup: true
  local_dir: app/build
  on:
    branch: development

before_install:
- openssl aes-256-cbc -K $encrypted_e96e21279759_key -iv $encrypted_e96e21279759_iv -in hackillinois.keystore.enc -out hackillinois.keystore -d
